{
  "id": "snapshot_1764073835786_i8ymyh0hz",
  "approvalId": "approval_1764073835772_5xwid1stj",
  "approvalTitle": "Network Simulator Integration Tasks Document",
  "version": 1,
  "timestamp": "2025-11-25T12:30:35.786Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document: Network Simulator Integration\n\n## Overview\n\nThis document breaks down the Network Simulator Integration implementation into discrete, actionable tasks based on the requirements and design specifications.\n\n## Task Groups\n\n### 1. Project Setup and Core Infrastructure\n\n#### 1.1 Project Structure Setup\n- [ ] Create `cardlink/netsim/` package directory\n- [ ] Create `__init__.py` with package exports\n- [ ] Create `types.py` for data classes and enums\n- [ ] Create `exceptions.py` for custom exceptions\n- [ ] Create `constants.py` for protocol constants\n- [ ] Add network-sim dependencies to `pyproject.toml`\n\n#### 1.2 Type Definitions\n- [ ] Define `SimulatorType` enum (AMARISOFT, GENERIC)\n- [ ] Define `CellStatus` enum (INACTIVE, ACTIVE, STARTING, STOPPING)\n- [ ] Define `SimulatorConfig` dataclass\n- [ ] Define `UEInfo` dataclass\n- [ ] Define `DataSession` dataclass\n- [ ] Define `CellInfo` dataclass\n- [ ] Define `SMSMessage` dataclass\n- [ ] Define `NetworkEvent` dataclass\n\n#### 1.3 Exception Definitions\n- [ ] Create `NetworkSimulatorError` base exception\n- [ ] Create `ConnectionError` for connection failures\n- [ ] Create `AuthenticationError` for auth failures\n- [ ] Create `CommandError` for command execution failures\n- [ ] Create `TimeoutError` for operation timeouts\n- [ ] Create `ConfigurationError` for config errors\n\n### 2. Connection Layer\n\n#### 2.1 Base Connection Interface\n- [ ] Create `connection.py` module\n- [ ] Define `BaseConnection` abstract class\n- [ ] Define `connect()` abstract method\n- [ ] Define `disconnect()` abstract method\n- [ ] Define `send()` abstract method\n- [ ] Define `receive()` abstract method\n- [ ] Define `on_message()` abstract method\n- [ ] Define `is_connected()` abstract method\n\n#### 2.2 WebSocket Connection Implementation\n- [ ] Create `WSConnection` class extending `BaseConnection`\n- [ ] Implement `__init__` with URL and TLS config\n- [ ] Implement `connect()` with websockets library\n- [ ] Implement SSL context creation for TLS\n- [ ] Configure ping/pong keepalive (30s interval, 10s timeout)\n- [ ] Implement `disconnect()` with graceful close\n- [ ] Implement `send()` with JSON serialization\n- [ ] Implement `receive()` with JSON deserialization\n- [ ] Implement `on_message()` callback registration\n- [ ] Implement `is_connected()` property\n- [ ] Implement `_receive_loop()` background task\n- [ ] Handle `websockets.ConnectionClosed` exceptions\n- [ ] Add connection state tracking\n\n#### 2.3 TCP Connection Implementation\n- [ ] Create `TCPConnection` class extending `BaseConnection`\n- [ ] Implement `__init__` with URL parsing\n- [ ] Implement `connect()` with asyncio.open_connection\n- [ ] Implement SSL context for TLS\n- [ ] Implement `disconnect()` with writer close\n- [ ] Implement `send()` with newline-delimited JSON\n- [ ] Implement `receive()` with readline\n- [ ] Implement `on_message()` callback registration\n- [ ] Implement `is_connected()` property\n- [ ] Implement `_receive_loop()` background task\n- [ ] Handle connection closed detection\n\n#### 2.4 Reconnection Manager\n- [ ] Create `ReconnectManager` class\n- [ ] Implement `__init__` with backoff config\n- [ ] Implement exponential backoff calculation\n- [ ] Implement `reconnect()` with retry loop\n- [ ] Track reconnection attempts\n- [ ] Implement maximum delay cap\n- [ ] Implement `reset()` to clear state\n- [ ] Add reconnection event callbacks\n- [ ] Handle concurrent reconnection attempts\n\n### 3. Simulator Interface\n\n#### 3.1 Abstract Interface Definition\n- [ ] Create `interface.py` module\n- [ ] Define `SimulatorInterface` abstract class\n- [ ] Define `authenticate()` abstract method\n- [ ] Define `get_cell_status()` abstract method\n- [ ] Define `start_cell()` abstract method\n- [ ] Define `stop_cell()` abstract method\n- [ ] Define `configure_cell()` abstract method\n- [ ] Define `list_ues()` abstract method\n- [ ] Define `get_ue()` abstract method\n- [ ] Define `detach_ue()` abstract method\n- [ ] Define `list_sessions()` abstract method\n- [ ] Define `release_session()` abstract method\n- [ ] Define `send_sms()` abstract method\n- [ ] Define `trigger_event()` abstract method\n- [ ] Define `get_config()` abstract method\n- [ ] Define `set_config()` abstract method\n- [ ] Define `subscribe_events()` abstract method\n\n#### 3.2 Amarisoft Adapter Implementation\n- [ ] Create `adapters/amarisoft.py` module\n- [ ] Create `AmarisoftAdapter` class implementing `SimulatorInterface`\n- [ ] Implement `__init__` with connection and request tracking\n- [ ] Implement JSON-RPC 2.0 request formatting\n- [ ] Implement `_handle_message()` for response routing\n- [ ] Implement `_send_request()` with timeout handling\n- [ ] Implement request ID generation and tracking\n- [ ] Implement pending request future management\n- [ ] Handle error responses\n- [ ] Handle event notifications\n\n#### 3.3 Amarisoft Authentication\n- [ ] Implement `authenticate()` method\n- [ ] Send auth request with API key\n- [ ] Handle authentication success/failure\n- [ ] Store authentication state\n\n#### 3.4 Amarisoft Cell Operations\n- [ ] Implement `get_cell_status()` with `enb.get_status`\n- [ ] Parse cell status response into `CellInfo`\n- [ ] Implement `start_cell()` with `enb.start`\n- [ ] Implement `stop_cell()` with `enb.stop`\n- [ ] Implement `configure_cell()` with `enb.configure`\n- [ ] Handle LTE (eNB) and 5G NR (gNB) variants\n\n#### 3.5 Amarisoft UE Operations\n- [ ] Implement `list_ues()` with `ue.list`\n- [ ] Parse UE list response into `List[UEInfo]`\n- [ ] Implement `get_ue()` with `ue.get`\n- [ ] Implement `detach_ue()` with `ue.detach`\n\n#### 3.6 Amarisoft Session Operations\n- [ ] Implement `list_sessions()` with `session.list`\n- [ ] Parse session list response into `List[DataSession]`\n- [ ] Implement `release_session()` with `session.release`\n\n#### 3.7 Amarisoft SMS Operations\n- [ ] Implement `send_sms()` with `sms.send`\n- [ ] Convert PDU bytes to hex string\n- [ ] Handle delivery acknowledgment\n\n#### 3.8 Amarisoft Event and Config Operations\n- [ ] Implement `trigger_event()` with dynamic method routing\n- [ ] Implement `get_config()` with `config.get`\n- [ ] Implement `set_config()` with `config.set`\n- [ ] Implement `subscribe_events()` callback registration\n\n#### 3.9 Generic Adapter\n- [ ] Create `adapters/generic.py` module\n- [ ] Create `GenericAdapter` class implementing `SimulatorInterface`\n- [ ] Implement basic REST-like API communication\n- [ ] Provide stub implementations for all methods\n\n### 4. Manager Components\n\n#### 4.1 Simulator Manager\n- [ ] Create `manager.py` module\n- [ ] Create `SimulatorManager` class\n- [ ] Implement `__init__` with config and event emitter\n- [ ] Implement `connect()` with protocol selection\n- [ ] Create connection based on protocol type\n- [ ] Setup reconnection manager if enabled\n- [ ] Create adapter based on simulator type\n- [ ] Authenticate if API key provided\n- [ ] Initialize sub-managers\n- [ ] Start event monitoring\n- [ ] Emit `simulator_connected` event\n- [ ] Handle connection errors\n\n#### 4.2 Simulator Manager Disconnect\n- [ ] Implement `disconnect()` method\n- [ ] Close connection gracefully\n- [ ] Stop event monitoring\n- [ ] Clear sub-managers\n- [ ] Emit `simulator_disconnected` event\n\n#### 4.3 Simulator Manager Status\n- [ ] Implement `get_status()` method\n- [ ] Aggregate cell status\n- [ ] Aggregate UE count\n- [ ] Aggregate session count\n- [ ] Handle status retrieval errors\n- [ ] Implement `is_connected` property\n\n#### 4.4 Simulator Manager Properties\n- [ ] Implement `ue` property returning UEManager\n- [ ] Implement `sessions` property returning SessionManager\n- [ ] Implement `sms` property returning SMSManager\n- [ ] Implement `cell` property returning CellManager\n- [ ] Implement `config` property returning ConfigManager\n- [ ] Implement `events` property returning EventManager\n\n### 5. UE Manager\n\n#### 5.1 UE Manager Core\n- [ ] Create `managers/ue.py` module\n- [ ] Create `UEManager` class\n- [ ] Implement `__init__` with adapter and event emitter\n- [ ] Initialize UE cache dictionary\n- [ ] Initialize waiter tracking\n- [ ] Subscribe to UE events from adapter\n\n#### 5.2 UE Event Handling\n- [ ] Implement `_handle_event()` method\n- [ ] Handle `ue_attached` events\n- [ ] Update UE cache on attach\n- [ ] Notify waiters on attach\n- [ ] Emit `ue_registered` event\n- [ ] Handle `ue_detached` events\n- [ ] Remove from cache on detach\n- [ ] Emit `ue_deregistered` event\n\n#### 5.3 UE Query Operations\n- [ ] Implement `list_ues()` method\n- [ ] Fetch from adapter and update cache\n- [ ] Implement `get_ue()` method\n- [ ] Check cache first, then fetch\n- [ ] Implement `get_cached_ues()` for local access\n\n#### 5.4 UE Wait for Registration\n- [ ] Implement `wait_for_registration()` method\n- [ ] Check if already registered\n- [ ] Create asyncio.Event waiter\n- [ ] Add to waiters dictionary\n- [ ] Wait with timeout\n- [ ] Clean up waiter on completion\n- [ ] Return success/timeout status\n\n#### 5.5 UE Detach Operation\n- [ ] Implement `detach_ue()` method\n- [ ] Call adapter detach\n- [ ] Update local cache\n\n### 6. Session Manager\n\n#### 6.1 Session Manager Core\n- [ ] Create `managers/session.py` module\n- [ ] Create `SessionManager` class\n- [ ] Implement `__init__` with adapter and event emitter\n- [ ] Initialize session cache\n- [ ] Subscribe to session events\n\n#### 6.2 Session Event Handling\n- [ ] Implement `_handle_event()` method\n- [ ] Handle `pdn_connected` events\n- [ ] Handle `pdn_disconnected` events\n- [ ] Emit `data_session_activated` event\n- [ ] Emit `data_session_deactivated` event\n\n#### 6.3 Session Query Operations\n- [ ] Implement `list_sessions()` method\n- [ ] Implement `get_session()` method\n- [ ] Implement `get_sessions_by_imsi()` method\n\n#### 6.4 Session Control Operations\n- [ ] Implement `release_session()` method\n- [ ] Handle release confirmation\n\n### 7. SMS Manager\n\n#### 7.1 SMS Manager Core\n- [ ] Create `managers/sms.py` module\n- [ ] Create `SMSManager` class\n- [ ] Implement `__init__` with adapter and event emitter\n- [ ] Initialize message history list\n- [ ] Initialize message ID counter\n- [ ] Subscribe to SMS events\n\n#### 7.2 SMS Event Handling\n- [ ] Implement `_handle_event()` method\n- [ ] Handle `sms_delivered` events\n- [ ] Update message status to delivered\n- [ ] Handle `sms_failed` events\n- [ ] Update message status to failed\n- [ ] Handle `sms_received` events (MO-SMS)\n- [ ] Emit `sms_delivered` event\n- [ ] Emit `sms_failed` event\n- [ ] Emit `sms_event` event\n\n#### 7.3 SMS Send Operations\n- [ ] Implement `send_mt_sms()` method\n- [ ] Generate message ID\n- [ ] Create SMSMessage record\n- [ ] Send via adapter\n- [ ] Handle send failure\n- [ ] Emit `sms_event` event\n- [ ] Return message ID\n\n#### 7.4 SMS-PP PDU Building\n- [ ] Implement `send_sms_pp_trigger()` method\n- [ ] Implement `_build_sms_pp_pdu()` method\n- [ ] Build SCA (Service Center Address)\n- [ ] Build PDU Type byte\n- [ ] Build Originating Address\n- [ ] Set Protocol Identifier for SIM Data Download (0x7F)\n- [ ] Set Data Coding Scheme (0xF6)\n- [ ] Build timestamp\n- [ ] Calculate User Data Length\n- [ ] Build User Data\n\n#### 7.5 SMS Address Encoding\n- [ ] Implement `_encode_address()` method\n- [ ] Parse phone number digits\n- [ ] Determine type byte (international/national)\n- [ ] BCD encode digits\n- [ ] Handle odd-length numbers with padding\n\n#### 7.6 OTA Command Packet Building\n- [ ] Implement `_build_ota_command_packet()` method\n- [ ] Set Command Packet Identifier\n- [ ] Build Command Header\n- [ ] Include TAR (Toolkit Application Reference)\n- [ ] Add SPI, KIc, KID fields\n\n#### 7.7 SMS History Operations\n- [ ] Implement `get_message_history()` method with limit\n- [ ] Implement `get_message()` by message ID\n- [ ] Implement `clear_history()` method\n\n### 8. Cell Manager\n\n#### 8.1 Cell Manager Core\n- [ ] Create `managers/cell.py` module\n- [ ] Create `CellManager` class\n- [ ] Implement `__init__` with adapter and event emitter\n- [ ] Track cell status locally\n\n#### 8.2 Cell Control Operations\n- [ ] Implement `start()` method\n- [ ] Emit `cell_starting` event\n- [ ] Wait for cell active\n- [ ] Emit `cell_started` event\n- [ ] Implement `stop()` method\n- [ ] Emit `cell_stopping` event\n- [ ] Wait for cell inactive\n- [ ] Emit `cell_stopped` event\n\n#### 8.3 Cell Status Operations\n- [ ] Implement `get_status()` method\n- [ ] Return `CellInfo` object\n- [ ] Implement `is_active()` property\n\n#### 8.4 Cell Configuration Operations\n- [ ] Implement `configure()` method\n- [ ] Validate configuration parameters\n- [ ] Apply configuration via adapter\n- [ ] Implement `set_plmn()` method\n- [ ] Implement `set_frequency()` method\n- [ ] Implement `set_power()` method\n\n### 9. Config Manager\n\n#### 9.1 Config Manager Core\n- [ ] Create `managers/config.py` module\n- [ ] Create `ConfigManager` class\n- [ ] Implement `__init__` with adapter\n\n#### 9.2 Config Query Operations\n- [ ] Implement `get()` method for full config\n- [ ] Implement `get_cell_config()` method\n- [ ] Implement `get_subscriber_config()` method\n- [ ] Implement `get_apn_config()` method\n\n#### 9.3 Config Update Operations\n- [ ] Implement `set()` method for full config\n- [ ] Implement `set_cell_config()` method\n- [ ] Implement `set_subscriber_config()` method\n- [ ] Implement `set_apn_config()` method\n\n#### 9.4 Config Persistence\n- [ ] Implement `save_to_file()` method\n- [ ] Serialize config to JSON/YAML\n- [ ] Implement `load_from_file()` method\n- [ ] Deserialize and validate config\n- [ ] Implement `validate()` method\n\n### 10. Event Manager\n\n#### 10.1 Event Manager Core\n- [ ] Create `managers/event.py` module\n- [ ] Create `EventManager` class\n- [ ] Implement `__init__` with adapter and event emitter\n- [ ] Initialize event history list\n- [ ] Initialize event ID counter\n- [ ] Initialize subscribers dictionary\n- [ ] Subscribe to simulator events\n\n#### 10.2 Event Handling\n- [ ] Implement `_handle_simulator_event()` method\n- [ ] Create NetworkEvent from raw event\n- [ ] Add to event history\n- [ ] Emit `network_event` to external emitter\n- [ ] Implement `_notify_subscribers()` method\n- [ ] Notify type-specific subscribers\n- [ ] Notify wildcard (*) subscribers\n\n#### 10.3 Event Subscription\n- [ ] Implement `subscribe()` method\n- [ ] Implement `unsubscribe()` method\n- [ ] Support removing specific callbacks\n- [ ] Support removing all callbacks for type\n\n#### 10.4 Event Monitoring\n- [ ] Implement `start_monitoring()` method\n- [ ] Implement `stop_monitoring()` method\n- [ ] Track monitoring state\n\n#### 10.5 Event Query Operations\n- [ ] Implement `get_event_history()` method\n- [ ] Filter by event type\n- [ ] Filter by time range\n- [ ] Apply limit\n\n#### 10.6 Event Correlation\n- [ ] Implement `correlate_events()` method\n- [ ] Filter by IMSI\n- [ ] Filter by time window\n- [ ] Return correlated events\n\n#### 10.7 Event Export\n- [ ] Implement `export_events()` method\n- [ ] Support JSON format export\n- [ ] Support CSV format export\n- [ ] Include all event fields\n\n### 11. Network Event Triggering\n\n#### 11.1 Event Trigger Operations\n- [ ] Create `triggers.py` module\n- [ ] Implement `trigger_paging()` method\n- [ ] Implement `trigger_handover()` method\n- [ ] Implement `trigger_service_request()` method\n- [ ] Implement `trigger_tau()` (Tracking Area Update)\n- [ ] Implement `trigger_rau()` (Routing Area Update)\n- [ ] Implement `trigger_detach()` method\n\n#### 11.2 Radio Condition Simulation\n- [ ] Implement `set_signal_strength()` method\n- [ ] Implement `simulate_radio_link_failure()` method\n- [ ] Implement `simulate_coverage_hole()` method\n\n#### 11.3 Scheduled Events\n- [ ] Implement `schedule_event()` method\n- [ ] Support delayed execution\n- [ ] Support recurring events\n- [ ] Implement `cancel_scheduled_event()` method\n\n### 12. Scenario Runner\n\n#### 12.1 Scenario Data Structures\n- [ ] Create `scenario.py` module\n- [ ] Define `StepStatus` enum\n- [ ] Define `ScenarioStep` dataclass\n- [ ] Define `StepResult` dataclass\n- [ ] Define `Scenario` dataclass\n\n#### 12.2 Scenario Loading\n- [ ] Implement `Scenario.from_yaml()` class method\n- [ ] Parse scenario name and description\n- [ ] Parse variables section\n- [ ] Parse steps list\n- [ ] Create ScenarioStep objects\n- [ ] Implement `Scenario.from_file()` method\n- [ ] Validate scenario structure\n\n#### 12.3 Scenario Runner Core\n- [ ] Create `ScenarioRunner` class\n- [ ] Implement `__init__` with managers\n- [ ] Initialize running state\n- [ ] Initialize results list\n- [ ] Initialize variables dictionary\n\n#### 12.4 Scenario Execution\n- [ ] Implement `run()` method\n- [ ] Set running state\n- [ ] Copy scenario variables\n- [ ] Emit `scenario_started` event\n- [ ] Iterate through steps\n- [ ] Check running state for abort\n- [ ] Check step conditions\n- [ ] Execute each step\n- [ ] Handle step failures\n- [ ] Emit `scenario_completed` event\n\n#### 12.5 Step Execution\n- [ ] Implement `_execute_step()` method\n- [ ] Create StepResult\n- [ ] Resolve parameters\n- [ ] Execute action with timeout\n- [ ] Handle timeout errors\n- [ ] Handle execution errors\n- [ ] Calculate duration\n- [ ] Emit `scenario_step_completed` event\n\n#### 12.6 Action Execution\n- [ ] Implement `_execute_action()` method\n- [ ] Create action map dictionary\n- [ ] Map `simulator.start_cell` action\n- [ ] Map `simulator.stop_cell` action\n- [ ] Map `simulator.wait_ue` action\n- [ ] Map `simulator.send_sms` action\n- [ ] Map `simulator.trigger_event` action\n- [ ] Map `wait` action\n- [ ] Map `set_variable` action\n- [ ] Handle unknown actions\n\n#### 12.7 Parameter Resolution\n- [ ] Implement `_resolve_params()` method\n- [ ] Detect variable references `${name}`\n- [ ] Replace with variable values\n- [ ] Handle missing variables\n\n#### 12.8 Condition Evaluation\n- [ ] Implement `_evaluate_condition()` method\n- [ ] Support `defined:` condition\n- [ ] Support comparison conditions\n- [ ] Support boolean combinations\n\n#### 12.9 Scenario Control\n- [ ] Implement `stop()` method\n- [ ] Implement `get_results()` method\n- [ ] Implement `get_current_step()` method\n\n### 13. Event Correlation\n\n#### 13.1 Event Correlator\n- [ ] Create `correlation.py` module\n- [ ] Create `EventCorrelator` class\n- [ ] Implement `__init__` with event sources\n\n#### 13.2 Correlation by Identifiers\n- [ ] Implement `correlate_by_imsi()` method\n- [ ] Implement `correlate_by_session()` method\n- [ ] Implement `correlate_by_timestamp()` method\n\n#### 13.3 Timeline Generation\n- [ ] Implement `generate_timeline()` method\n- [ ] Merge events from multiple sources\n- [ ] Sort by timestamp\n- [ ] Group by correlation ID\n\n#### 13.4 Correlation Export\n- [ ] Implement `export_timeline()` method\n- [ ] Support JSON format\n- [ ] Support CSV format\n- [ ] Support visualization data format\n\n### 14. CLI Implementation\n\n#### 14.1 CLI Setup\n- [ ] Create `cli.py` module\n- [ ] Setup Click application\n- [ ] Define main command group `cardlink-netsim`\n- [ ] Add global options (--verbose, --config)\n\n#### 14.2 Connect/Disconnect Commands\n- [ ] Implement `connect` command\n- [ ] Accept URL argument\n- [ ] Add `--type` option for simulator type\n- [ ] Add `--api-key` option\n- [ ] Add `--tls` flag\n- [ ] Display connection status\n- [ ] Implement `disconnect` command\n\n#### 14.3 Status Command\n- [ ] Implement `status` command\n- [ ] Display connection status\n- [ ] Display cell status\n- [ ] Display UE count\n- [ ] Display session count\n- [ ] Add `--json` option\n\n#### 14.4 Cell Commands\n- [ ] Implement `cell` command group\n- [ ] Implement `cell start` subcommand\n- [ ] Implement `cell stop` subcommand\n- [ ] Implement `cell status` subcommand\n- [ ] Add `--json` option\n\n#### 14.5 UE Commands\n- [ ] Implement `ue` command group\n- [ ] Implement `ue list` subcommand\n- [ ] Display IMSI, status, IP for each UE\n- [ ] Implement `ue get` subcommand with IMSI arg\n- [ ] Display detailed UE info\n- [ ] Implement `ue wait` subcommand with IMSI arg\n- [ ] Add `--timeout` option\n- [ ] Implement `ue detach` subcommand with IMSI arg\n\n#### 14.6 SMS Commands\n- [ ] Implement `sms` command group\n- [ ] Implement `sms send` subcommand\n- [ ] Accept IMSI and PDU arguments\n- [ ] Display send result\n- [ ] Implement `sms trigger` subcommand\n- [ ] Accept IMSI argument\n- [ ] Add `--tar` option for TAR hex value\n\n#### 14.7 Event Commands\n- [ ] Implement `event` command group\n- [ ] Implement `event trigger` subcommand\n- [ ] Accept event type argument\n- [ ] Add parameter options\n- [ ] Implement `event list` subcommand\n- [ ] Add `--type` filter\n- [ ] Add `--limit` option\n- [ ] Implement `event export` subcommand\n- [ ] Accept output file argument\n- [ ] Add `--format` option (json, csv)\n\n#### 14.8 Scenario Commands\n- [ ] Implement `scenario` command group\n- [ ] Implement `scenario run` subcommand\n- [ ] Accept scenario file argument\n- [ ] Display progress and results\n- [ ] Implement `scenario validate` subcommand\n- [ ] Check YAML syntax\n- [ ] Validate step actions\n- [ ] Implement `scenario list` subcommand\n- [ ] List scenarios in directory\n\n#### 14.9 Config Commands\n- [ ] Implement `config` command group\n- [ ] Implement `config show` subcommand\n- [ ] Display current configuration\n- [ ] Implement `config load` subcommand\n- [ ] Accept config file argument\n- [ ] Implement `config save` subcommand\n- [ ] Accept output file argument\n\n### 15. Dashboard Integration\n\n#### 15.1 Dashboard API Endpoints\n- [ ] Create dashboard API routes for simulator\n- [ ] Implement `GET /api/simulator/status` endpoint\n- [ ] Implement `POST /api/simulator/connect` endpoint\n- [ ] Implement `POST /api/simulator/disconnect` endpoint\n- [ ] Implement `GET /api/simulator/ues` endpoint\n- [ ] Implement `GET /api/simulator/sessions` endpoint\n- [ ] Implement `GET /api/simulator/events` endpoint\n- [ ] Implement `POST /api/simulator/cell/start` endpoint\n- [ ] Implement `POST /api/simulator/cell/stop` endpoint\n- [ ] Implement `POST /api/simulator/sms/send` endpoint\n\n#### 15.2 Dashboard WebSocket Updates\n- [ ] Create WebSocket channel for simulator events\n- [ ] Broadcast UE registration events\n- [ ] Broadcast session events\n- [ ] Broadcast SMS events\n- [ ] Broadcast cell status changes\n\n#### 15.3 Dashboard UI Components\n- [ ] Create simulator status component\n- [ ] Display connection indicator\n- [ ] Display cell status\n- [ ] Create UE list component\n- [ ] Display IMSI, status, IP columns\n- [ ] Add refresh button\n- [ ] Create event stream component\n- [ ] Display real-time events\n- [ ] Add filtering controls\n- [ ] Create control panel component\n- [ ] Add connect/disconnect buttons\n- [ ] Add cell start/stop buttons\n- [ ] Add SMS send form\n\n### 16. Event Emission\n\n#### 16.1 Event Emitter Integration\n- [ ] Create `events.py` module\n- [ ] Define event type constants\n- [ ] Define event payload schemas\n\n#### 16.2 Connection Events\n- [ ] Emit `simulator_connected` on connect\n- [ ] Include URL and type in payload\n- [ ] Emit `simulator_disconnected` on disconnect\n- [ ] Emit `simulator_error` on errors\n- [ ] Include error details in payload\n\n#### 16.3 UE Events\n- [ ] Emit `ue_registered` on attachment\n- [ ] Include IMSI, IMEI, cell_id\n- [ ] Emit `ue_deregistered` on detachment\n- [ ] Include IMSI and cause\n\n#### 16.4 Session Events\n- [ ] Emit `data_session_changed` on session changes\n- [ ] Include session details and change type\n\n#### 16.5 SMS Events\n- [ ] Emit `sms_event` on SMS send/receive\n- [ ] Include direction, IMSI, PDU\n\n#### 16.6 Network Events\n- [ ] Emit `network_event` for all simulator events\n- [ ] Include event type and full data\n\n### 17. Testing\n\n#### 17.1 Unit Tests - Connection Layer\n- [ ] Test `WSConnection` connect/disconnect\n- [ ] Test `WSConnection` send/receive\n- [ ] Test `WSConnection` message callbacks\n- [ ] Test `TCPConnection` connect/disconnect\n- [ ] Test `TCPConnection` send/receive\n- [ ] Test `TCPConnection` message callbacks\n- [ ] Test `ReconnectManager` backoff calculation\n- [ ] Test `ReconnectManager` retry logic\n\n#### 17.2 Unit Tests - Amarisoft Adapter\n- [ ] Test request ID generation\n- [ ] Test JSON-RPC request formatting\n- [ ] Test response handling\n- [ ] Test error handling\n- [ ] Test event notification handling\n- [ ] Test authentication flow\n- [ ] Test cell operations\n- [ ] Test UE operations\n- [ ] Test session operations\n- [ ] Test SMS operations\n\n#### 17.3 Unit Tests - Managers\n- [ ] Test `SimulatorManager` initialization\n- [ ] Test `SimulatorManager` connect flow\n- [ ] Test `SimulatorManager` status aggregation\n- [ ] Test `UEManager` event handling\n- [ ] Test `UEManager` wait_for_registration\n- [ ] Test `SMSManager` send operations\n- [ ] Test `SMSManager` PDU building\n- [ ] Test `EventManager` subscription\n- [ ] Test `EventManager` correlation\n\n#### 17.4 Unit Tests - Scenario Runner\n- [ ] Test `Scenario.from_yaml()` parsing\n- [ ] Test step execution\n- [ ] Test timeout handling\n- [ ] Test condition evaluation\n- [ ] Test variable resolution\n- [ ] Test action mapping\n\n#### 17.5 Unit Tests - SMS PDU\n- [ ] Test address encoding\n- [ ] Test SMS-PP PDU structure\n- [ ] Test OTA command packet building\n- [ ] Test various TAR values\n\n#### 17.6 Integration Tests\n- [ ] Test full connect/disconnect cycle\n- [ ] Test UE registration monitoring\n- [ ] Test SMS injection\n- [ ] Test event correlation\n- [ ] Test scenario execution\n\n#### 17.7 Mock Simulator\n- [ ] Create mock Amarisoft simulator for testing\n- [ ] Implement WebSocket server\n- [ ] Implement basic API responses\n- [ ] Implement event generation\n\n### 18. Documentation\n\n#### 18.1 API Documentation\n- [ ] Document `SimulatorManager` class\n- [ ] Document `SimulatorInterface` methods\n- [ ] Document connection configuration\n- [ ] Document event types and payloads\n\n#### 18.2 Usage Documentation\n- [ ] Write connection setup guide\n- [ ] Write Amarisoft integration guide\n- [ ] Write CLI usage guide\n- [ ] Write scenario authoring guide\n\n#### 18.3 Example Scenarios\n- [ ] Create basic UE registration scenario\n- [ ] Create SMS trigger scenario\n- [ ] Create OTA session scenario\n- [ ] Create network event scenario\n\n### 19. Error Handling and Resilience\n\n#### 19.1 Connection Error Handling\n- [ ] Handle connection refused errors\n- [ ] Handle connection timeout errors\n- [ ] Handle connection reset errors\n- [ ] Handle TLS/SSL errors\n\n#### 19.2 Command Error Handling\n- [ ] Handle command timeout errors\n- [ ] Handle invalid response errors\n- [ ] Handle authentication errors\n- [ ] Handle rate limiting errors\n\n#### 19.3 Recovery Mechanisms\n- [ ] Implement automatic reconnection\n- [ ] Implement request retry logic\n- [ ] Implement circuit breaker pattern\n- [ ] Implement graceful degradation\n\n#### 19.4 Error Reporting\n- [ ] Log connection errors with context\n- [ ] Log command errors with request details\n- [ ] Emit error events for monitoring\n- [ ] Provide user-friendly error messages\n\n### 20. Performance and Optimization\n\n#### 20.1 Connection Optimization\n- [ ] Implement connection pooling (if needed)\n- [ ] Optimize keepalive intervals\n- [ ] Implement message batching (if beneficial)\n\n#### 20.2 Event Processing Optimization\n- [ ] Implement event buffering\n- [ ] Implement async event dispatch\n- [ ] Limit event history size\n- [ ] Implement event deduplication\n\n#### 20.3 Memory Management\n- [ ] Limit UE cache size\n- [ ] Limit session cache size\n- [ ] Limit message history size\n- [ ] Implement cache eviction policies\n\n## Implementation Order\n\n### Phase 1: Core Infrastructure (Tasks 1-3)\n1. Project setup and types\n2. Connection layer (WebSocket, TCP, Reconnect)\n3. Simulator interface and Amarisoft adapter\n\n### Phase 2: Manager Components (Tasks 4-10)\n4. Simulator Manager\n5. UE Manager\n6. Session Manager\n7. SMS Manager\n8. Cell Manager\n9. Config Manager\n10. Event Manager\n\n### Phase 3: Advanced Features (Tasks 11-13)\n11. Network event triggering\n12. Scenario runner\n13. Event correlation\n\n### Phase 4: Interface Integration (Tasks 14-16)\n14. CLI implementation\n15. Dashboard integration\n16. Event emission\n\n### Phase 5: Quality Assurance (Tasks 17-20)\n17. Testing\n18. Documentation\n19. Error handling\n20. Performance optimization\n\n## Dependencies\n\n### External Dependencies\n- `websockets>=11.0` - WebSocket client\n- `pyyaml>=6.0` - YAML scenario parsing\n\n### Internal Dependencies\n- Core event emitter from CardLink\n- Dashboard API framework\n- Configuration management\n\n## Notes\n\n- Amarisoft Remote API documentation required for accurate implementation\n- Test with actual Amarisoft Callbox for integration validation\n- Consider future support for other simulator vendors (srsRAN, OpenAirInterface)\n- SMS-PP PDU encoding should follow 3GPP TS 23.048 and TS 31.115\n",
  "fileStats": {
    "size": 28289,
    "lines": 884,
    "lastModified": "2025-11-25T12:30:29.622Z"
  },
  "comments": []
}