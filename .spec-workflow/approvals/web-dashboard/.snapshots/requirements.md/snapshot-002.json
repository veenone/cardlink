{
  "id": "snapshot_1764067629276_6f1lg7h31",
  "approvalId": "approval_1764067502692_hk5fvocsf",
  "approvalTitle": "Web Dashboard Requirements Document",
  "version": 2,
  "timestamp": "2025-11-25T10:47:09.276Z",
  "trigger": "revision_requested",
  "status": "pending",
  "content": "# Requirements Document: Web Dashboard\n\n## Introduction\n\nThe Web Dashboard is the graphical frontend component of CardLink that provides real-time monitoring, interactive testing, and log management capabilities for the PSK-TLS Admin Server. It enables testers to visualize TLS handshakes, monitor APDU exchanges, execute manual RAM commands, and export communication logs for analysis.\n\nThis component serves as the primary interface for interactive testing sessions, complementing the CLI tools with a visual representation of OTA communication flows.\n\n## Alignment with Product Vision\n\nThis feature directly supports CardLink's core mission of providing accessible SCP81 compliance testing:\n\n- **Protocol transparency**: Visual representation of TLS handshakes and APDU exchanges in real-time\n- **Interactive testing**: Manual RAM command execution without scripting\n- **Debugging support**: Detailed views of communication logs with hex/decoded formats\n- **Export capabilities**: Log export for reporting and external analysis\n- **Accessibility**: Web-based interface accessible from any browser without installation\n\n## Requirements\n\n### Requirement 1: Real-Time Session Monitoring\n\n**User Story:** As a tester, I want to see active OTA sessions in real-time, so that I can monitor ongoing test operations and quickly identify issues.\n\n#### Acceptance Criteria\n\n1. WHEN a TLS connection is established THEN the dashboard SHALL display the new session within 500ms\n2. WHEN viewing sessions THEN the dashboard SHALL show session ID, PSK identity, cipher suite, connection time, and status\n3. WHEN a session state changes THEN the dashboard SHALL update the display immediately via WebSocket\n4. WHEN viewing sessions THEN the dashboard SHALL show the number of APDU commands exchanged\n5. WHEN a session ends THEN the dashboard SHALL update status and show duration\n\n### Requirement 2: TLS Handshake Visualization\n\n**User Story:** As a UICC developer, I want to see TLS handshake details, so that I can verify PSK negotiation is working correctly.\n\n#### Acceptance Criteria\n\n1. WHEN a TLS handshake starts THEN the dashboard SHALL display handshake progress indicator\n2. WHEN a TLS handshake completes THEN the dashboard SHALL show:\n   - PSK identity used\n   - Negotiated cipher suite\n   - TLS version\n   - Handshake duration (ms)\n3. WHEN a handshake fails THEN the dashboard SHALL display the failure reason and TLS alert code\n4. WHEN NULL cipher is negotiated THEN the dashboard SHALL display a prominent warning indicator\n5. WHEN viewing handshake history THEN the dashboard SHALL list recent handshakes with their outcomes\n\n### Requirement 3: APDU Communication Log\n\n**User Story:** As a QA engineer, I want to see all APDU commands and responses, so that I can analyze the communication between server and UICC.\n\n#### Acceptance Criteria\n\n1. WHEN an APDU command is received THEN the dashboard SHALL display it within 100ms\n2. WHEN viewing APDU logs THEN the dashboard SHALL show:\n   - Direction (received/sent)\n   - Timestamp\n   - Raw hex bytes\n   - Decoded command (CLA, INS, P1, P2, Lc, Data, Le)\n   - Status word for responses\n   - Response time (ms)\n3. WHEN viewing logs THEN the dashboard SHALL support filtering by session, command type, or status word\n4. WHEN an APDU log entry is clicked THEN the dashboard SHALL show expanded detail view\n5. WHEN new APDUs arrive THEN the dashboard SHALL auto-scroll to latest unless user has scrolled up\n\n### Requirement 4: Manual RAM Command Interface\n\n**User Story:** As a tester, I want to send manual GlobalPlatform commands to the UICC, so that I can perform interactive testing without scripting.\n\n#### Acceptance Criteria\n\n1. WHEN an active session exists THEN the dashboard SHALL enable the command interface\n2. WHEN building a command THEN the dashboard SHALL provide a form with:\n   - Command type selector (SELECT, GET STATUS, INSTALL, DELETE, etc.)\n   - Parameter fields appropriate for selected command\n   - Raw hex input option for advanced users\n3. WHEN a command is submitted THEN the dashboard SHALL send it through the active session\n4. WHEN a response is received THEN the dashboard SHALL display it inline with the command\n5. WHEN no active session exists THEN the dashboard SHALL disable command interface with explanation\n\n### Requirement 5: Command Builder Templates\n\n**User Story:** As a tester, I want pre-built command templates, so that I can quickly execute common GP commands without remembering byte formats.\n\n#### Acceptance Criteria\n\n1. WHEN opening command builder THEN the dashboard SHALL offer templates for:\n   - SELECT (by AID)\n   - GET STATUS (ISD, Applications, Load Files)\n   - GET DATA (various tags)\n   - INITIALIZE UPDATE\n2. WHEN selecting a template THEN the dashboard SHALL pre-fill appropriate parameters\n3. WHEN a template has variable fields THEN the dashboard SHALL provide labeled input fields\n4. WHEN submitting a templated command THEN the dashboard SHALL show both template name and raw bytes\n\n### Requirement 6: Log Export\n\n**User Story:** As a QA engineer, I want to export communication logs, so that I can include them in test reports or analyze them externally.\n\n#### Acceptance Criteria\n\n1. WHEN exporting logs THEN the dashboard SHALL support JSON format with full detail\n2. WHEN exporting logs THEN the dashboard SHALL support CSV format for spreadsheet analysis\n3. WHEN exporting logs THEN the dashboard SHALL allow filtering by session or time range\n4. WHEN exporting THEN the dashboard SHALL include session metadata (PSK identity, cipher, duration)\n5. WHEN export is requested THEN the dashboard SHALL generate downloadable file within 5 seconds\n\n### Requirement 7: Dashboard Configuration\n\n**User Story:** As an administrator, I want to configure dashboard behavior, so that I can adapt it to my workflow.\n\n#### Acceptance Criteria\n\n1. WHEN configuring display THEN the dashboard SHALL support hex/ASCII toggle for data display\n2. WHEN configuring display THEN the dashboard SHALL support timestamp format selection (local/UTC)\n3. WHEN configuring logs THEN the dashboard SHALL support max entries limit (default 1000)\n4. WHEN configuring THEN the dashboard SHALL persist preferences in browser local storage\n5. WHEN configuring THEN the dashboard SHALL support dark/light theme toggle\n\n### Requirement 8: Connection Status\n\n**User Story:** As a tester, I want to see the connection status to the server, so that I know when the dashboard is receiving live updates.\n\n#### Acceptance Criteria\n\n1. WHEN the dashboard connects to server THEN it SHALL display \"Connected\" status indicator\n2. WHEN the WebSocket connection is lost THEN the dashboard SHALL display \"Disconnected\" with retry countdown\n3. WHEN reconnecting THEN the dashboard SHALL automatically retry every 5 seconds\n4. WHEN reconnected THEN the dashboard SHALL restore subscription to events\n5. WHEN server is unreachable THEN the dashboard SHALL display helpful error message\n\n### Requirement 9: Error and Alert Display\n\n**User Story:** As a tester, I want to see errors and alerts prominently, so that I can quickly identify problems during testing.\n\n#### Acceptance Criteria\n\n1. WHEN a PSK mismatch occurs THEN the dashboard SHALL display alert with identity and source IP\n2. WHEN a connection is interrupted THEN the dashboard SHALL display alert with session details\n3. WHEN handshake fails THEN the dashboard SHALL display alert with failure reason\n4. WHEN high error rate is detected THEN the dashboard SHALL display warning banner\n5. WHEN viewing alerts THEN the dashboard SHALL show timestamp and allow dismissal\n\n### Requirement 10: Health and Metrics Overview\n\n**User Story:** As an administrator, I want to see server health and basic metrics, so that I can monitor system status.\n\n#### Acceptance Criteria\n\n1. WHEN viewing dashboard THEN it SHALL display server uptime\n2. WHEN viewing dashboard THEN it SHALL display active session count\n3. WHEN viewing dashboard THEN it SHALL display total sessions since start\n4. WHEN viewing dashboard THEN it SHALL display total APDU commands processed\n5. WHEN viewing dashboard THEN it SHALL provide link to Prometheus metrics endpoint\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n\n- **Separation of Concerns**: Backend API routes separate from frontend static files\n- **Component-Based Frontend**: Modular JavaScript components for each feature area\n- **Event-Driven Updates**: WebSocket for all real-time updates, REST for initial load and exports\n- **Minimal Dependencies**: Vanilla JavaScript or minimal framework to reduce complexity\n\n### Performance\n\n- **Initial Load**: Dashboard SHALL load and be interactive within 2 seconds\n- **Real-time Latency**: Events SHALL appear on dashboard within 500ms of occurrence\n- **Log Capacity**: Dashboard SHALL handle display of 10,000+ log entries without degradation\n- **Memory Efficiency**: Dashboard SHALL use virtual scrolling for large log lists\n\n### Security\n\n- **Same-Origin**: Dashboard served from same origin as Admin Server\n- **No Authentication (v1.0)**: Local testing tool, authentication deferred to future version\n- **XSS Prevention**: All user input and log data properly escaped before display\n- **HTTPS Option**: Dashboard accessible via HTTPS when server uses TLS\n\n### Usability\n\n- **Responsive Design**: Dashboard usable on screens 1280px and wider\n- **Keyboard Navigation**: Support keyboard shortcuts for common actions\n- **Clear Feedback**: Loading states, success/error messages for all actions\n- **Help Text**: Tooltips and help text for command builder fields\n\n### Reliability\n\n- **Graceful Degradation**: Dashboard remains usable if WebSocket fails (manual refresh)\n- **State Recovery**: Dashboard recovers state on page refresh\n- **Error Boundaries**: JavaScript errors in one component don't crash entire dashboard\n",
  "fileStats": {
    "size": 9843,
    "lines": 192,
    "lastModified": "2025-11-25T10:44:57.427Z"
  },
  "comments": []
}