{
  "id": "snapshot_1764068174952_faprortly",
  "approvalId": "approval_1764067873019_xm2qvg2x7",
  "approvalTitle": "Web Dashboard Design Document",
  "version": 2,
  "timestamp": "2025-11-25T10:56:14.951Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Design Document: Web Dashboard\n\n## Technical Approach\n\n### Overview\n\nThe Web Dashboard is implemented as a single-page application (SPA) served by the CardLink Admin Server. It uses vanilla JavaScript with a modular component architecture, WebSocket for real-time updates, and a professional design system based on CSS custom properties (design tokens).\n\n### Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                              Web Dashboard                                   â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                              â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚                         Frontend (Browser)                           â”‚    â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚    â”‚\nâ”‚  â”‚  â”‚  Header   â”‚ â”‚  Session  â”‚ â”‚   APDU    â”‚ â”‚  Command  â”‚           â”‚    â”‚\nâ”‚  â”‚  â”‚ Component â”‚ â”‚   Panel   â”‚ â”‚    Log    â”‚ â”‚  Builder  â”‚           â”‚    â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚    â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚    â”‚\nâ”‚  â”‚  â”‚   Alert   â”‚ â”‚  Metrics  â”‚ â”‚  Settings â”‚ â”‚   Toast   â”‚           â”‚    â”‚\nâ”‚  â”‚  â”‚  Banner   â”‚ â”‚  Overview â”‚ â”‚   Modal   â”‚ â”‚  Manager  â”‚           â”‚    â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚    â”‚\nâ”‚  â”‚                         â”‚                                            â”‚    â”‚\nâ”‚  â”‚                         â–¼                                            â”‚    â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚\nâ”‚  â”‚  â”‚                    State Manager                             â”‚    â”‚    â”‚\nâ”‚  â”‚  â”‚  (sessions, logs, alerts, settings, connection status)       â”‚    â”‚    â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚\nâ”‚  â”‚                         â”‚                                            â”‚    â”‚\nâ”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚    â”‚\nâ”‚  â”‚           â–¼                           â–¼                             â”‚    â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚    â”‚\nâ”‚  â”‚  â”‚  WebSocket      â”‚         â”‚  REST API       â”‚                    â”‚    â”‚\nâ”‚  â”‚  â”‚  Client         â”‚         â”‚  Client         â”‚                    â”‚    â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                   â”‚                                          â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                    â”‚\n                                    â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                         Backend (Dashboard Server)                           â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚\nâ”‚  â”‚  Static File  â”‚  â”‚  REST API     â”‚  â”‚  WebSocket    â”‚                    â”‚\nâ”‚  â”‚  Server       â”‚  â”‚  Routes       â”‚  â”‚  Handler      â”‚                    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚\nâ”‚                            â”‚                   â”‚                             â”‚\nâ”‚                            â–¼                   â–¼                             â”‚\nâ”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚\nâ”‚                     â”‚      Event Subscriber           â”‚                     â”‚\nâ”‚                     â”‚   (AdminServer EventEmitter)    â”‚                     â”‚\nâ”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Key Design Decisions\n\n1. **Vanilla JavaScript**: No heavy frameworks to minimize bundle size and complexity. Modern ES6+ features provide sufficient structure.\n\n2. **Component-Based Architecture**: Each UI feature is a self-contained component with its own state, rendering, and event handling.\n\n3. **Design Tokens**: CSS custom properties for colors, spacing, typography ensure consistent styling and easy theming.\n\n4. **WebSocket for Real-Time**: All live updates via WebSocket; REST API for initial data load and exports.\n\n5. **Virtual Scrolling**: For APDU log with potentially thousands of entries, use virtual scrolling to maintain performance.\n\n6. **Progressive Enhancement**: Core features work without JavaScript errors in other components.\n\n## Component Design\n\n### Component 1: DashboardApp\n\n**Purpose**: Main application shell that initializes components and manages global state.\n\n**Interface**:\n```javascript\nclass DashboardApp {\n    constructor(config) {\n        // config: { apiBaseUrl, wsUrl }\n    }\n\n    async init() {\n        // Initialize all components, connect WebSocket, load initial data\n    }\n\n    getState() {\n        // Return current application state\n    }\n\n    subscribe(event, callback) {\n        // Subscribe to state changes\n    }\n}\n```\n\n**Key Behaviors**:\n- Initializes StateManager, WebSocketClient, APIClient\n- Creates and mounts all UI components\n- Handles global keyboard shortcuts\n- Manages application lifecycle\n\n### Component 2: StateManager\n\n**Purpose**: Centralized state management with subscription-based updates.\n\n**Interface**:\n```javascript\nclass StateManager {\n    constructor() {\n        this.state = {\n            sessions: [],           // Active and recent sessions\n            selectedSession: null,  // Currently selected session ID\n            logs: [],               // APDU log entries\n            alerts: [],             // Active alerts\n            metrics: {},            // Server metrics\n            settings: {},           // User preferences\n            connection: 'disconnected' // WebSocket status\n        };\n    }\n\n    getState(path) {\n        // Get state value at path (e.g., 'sessions', 'settings.theme')\n    }\n\n    setState(path, value) {\n        // Update state and notify subscribers\n    }\n\n    subscribe(path, callback) {\n        // Subscribe to changes at path\n    }\n\n    loadFromStorage() {\n        // Load persisted settings from localStorage\n    }\n\n    persistToStorage() {\n        // Save settings to localStorage\n    }\n}\n```\n\n**State Structure**:\n```javascript\n{\n    sessions: [\n        {\n            id: 'uuid',\n            pskIdentity: 'UICC_001',\n            cipherSuite: 'TLS_PSK_WITH_AES_128_CBC_SHA256',\n            state: 'active',\n            connectedAt: '2024-01-15T10:30:00Z',\n            commandCount: 42,\n            lastActivity: '2024-01-15T10:35:00Z'\n        }\n    ],\n    logs: [\n        {\n            id: 'uuid',\n            sessionId: 'uuid',\n            direction: 'received',\n            timestamp: '2024-01-15T10:35:00Z',\n            rawHex: '00A4040007A0000000041010',\n            decoded: { cla: '00', ins: 'A4', p1: '04', p2: '00', data: '...' },\n            responseTime: 45\n        }\n    ],\n    alerts: [\n        {\n            id: 'uuid',\n            type: 'psk_mismatch',\n            message: 'PSK mismatch for identity UICC_002',\n            timestamp: '2024-01-15T10:32:00Z',\n            dismissed: false\n        }\n    ],\n    metrics: {\n        uptime: 3600,\n        totalSessions: 150,\n        activeSessions: 2,\n        totalCommands: 5420\n    },\n    settings: {\n        theme: 'light',\n        hexDisplay: 'uppercase',\n        timestampFormat: 'relative',\n        maxLogEntries: 1000,\n        autoScroll: true\n    },\n    connection: 'connected'\n}\n```\n\n### Component 3: WebSocketClient\n\n**Purpose**: Manages WebSocket connection with auto-reconnect and message routing.\n\n**Interface**:\n```javascript\nclass WebSocketClient {\n    constructor(url, stateManager) {\n        this.url = url;\n        this.stateManager = stateManager;\n        this.reconnectAttempts = 0;\n        this.maxReconnectAttempts = 10;\n        this.reconnectDelay = 5000;\n    }\n\n    connect() {\n        // Establish WebSocket connection\n    }\n\n    disconnect() {\n        // Close connection gracefully\n    }\n\n    send(message) {\n        // Send message to server\n    }\n\n    onMessage(handler) {\n        // Register message handler\n    }\n}\n```\n\n**Message Types**:\n| Type | Direction | Description |\n|------|-----------|-------------|\n| `session_created` | Serverâ†’Client | New session established |\n| `session_updated` | Serverâ†’Client | Session state changed |\n| `session_ended` | Serverâ†’Client | Session closed |\n| `apdu_received` | Serverâ†’Client | APDU command received |\n| `apdu_sent` | Serverâ†’Client | APDU response sent |\n| `alert` | Serverâ†’Client | Error/warning alert |\n| `metrics_update` | Serverâ†’Client | Metrics refresh |\n| `send_command` | Clientâ†’Server | Manual command request |\n\n**Key Behaviors**:\n- Auto-reconnect with exponential backoff (max 5 attempts)\n- Connection status updates to StateManager\n- Message routing to appropriate handlers\n- Heartbeat/ping to detect stale connections\n\n### Component 4: APIClient\n\n**Purpose**: REST API client for initial data load and exports.\n\n**Interface**:\n```javascript\nclass APIClient {\n    constructor(baseUrl) {\n        this.baseUrl = baseUrl;\n    }\n\n    async getSessions() {\n        // GET /api/sessions\n    }\n\n    async getSessionLogs(sessionId, options) {\n        // GET /api/sessions/{id}/logs?limit=100&offset=0\n    }\n\n    async getMetrics() {\n        // GET /api/metrics\n    }\n\n    async sendCommand(sessionId, command) {\n        // POST /api/sessions/{id}/commands\n    }\n\n    async exportLogs(options) {\n        // GET /api/export?format=json&sessionId=...\n    }\n}\n```\n\n**API Endpoints**:\n| Endpoint | Method | Description |\n|----------|--------|-------------|\n| `/api/sessions` | GET | List all sessions |\n| `/api/sessions/{id}` | GET | Get session details |\n| `/api/sessions/{id}/logs` | GET | Get session APDU logs |\n| `/api/metrics` | GET | Get server metrics |\n| `/api/sessions/{id}/commands` | POST | Send manual command |\n| `/api/export` | GET | Export logs (JSON/CSV) |\n| `/api/health` | GET | Health check |\n\n### Component 5: HeaderComponent\n\n**Purpose**: Top navigation bar with connection status, metrics summary, and settings access.\n\n**Interface**:\n```javascript\nclass HeaderComponent {\n    constructor(container, stateManager) {\n        this.container = container;\n        this.stateManager = stateManager;\n    }\n\n    render() {\n        // Render header HTML\n    }\n\n    update(state) {\n        // Update connection indicator, metrics badges\n    }\n}\n```\n\n**Layout**:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  ğŸ”— CardLink Dashboard    â”‚ â— Connected â”‚ Sessions: 2 â”‚ Commands: 542 â”‚ âš™ï¸ â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Key Behaviors**:\n- Connection status indicator (green=connected, red=disconnected, yellow=reconnecting)\n- Real-time metrics badges\n- Settings gear opens SettingsModal\n- Logo/title links to documentation\n\n### Component 6: SessionPanel\n\n**Purpose**: Displays active and recent sessions with selection capability.\n\n**Interface**:\n```javascript\nclass SessionPanel {\n    constructor(container, stateManager) {\n        this.container = container;\n        this.stateManager = stateManager;\n    }\n\n    render() {\n        // Render session list\n    }\n\n    selectSession(sessionId) {\n        // Update selected session in state\n    }\n\n    formatSessionCard(session) {\n        // Generate HTML for session card\n    }\n}\n```\n\n**Session Card Layout**:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ ğŸŸ¢ UICC_001                          â”‚\nâ”‚ TLS_PSK_WITH_AES_128_CBC_SHA256      â”‚\nâ”‚ Connected 5 min ago â€¢ 42 commands    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Key Behaviors**:\n- Shows active sessions prominently (sorted first)\n- Clicking session selects it and filters APDU log\n- Visual distinction for session states (active=green, closed=gray)\n- NULL cipher warning badge when applicable\n- Empty state with \"Waiting for connections...\" message\n\n### Component 7: APDULogComponent\n\n**Purpose**: Displays APDU command/response log with filtering and virtual scrolling.\n\n**Interface**:\n```javascript\nclass APDULogComponent {\n    constructor(container, stateManager) {\n        this.container = container;\n        this.stateManager = stateManager;\n        this.virtualScroller = null;\n    }\n\n    render() {\n        // Render log container with virtual scrolling\n    }\n\n    addEntry(entry) {\n        // Add new log entry (with auto-scroll if enabled)\n    }\n\n    filter(criteria) {\n        // Filter logs by session, command type, status word\n    }\n\n    expandEntry(entryId) {\n        // Show detailed view of entry\n    }\n\n    formatEntry(entry) {\n        // Generate HTML for log entry\n    }\n}\n```\n\n**Log Entry Layout**:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ â†“ 10:35:42  SELECT           00 A4 04 00 07 A0 00 00 00 04 10 10       â”‚\nâ”‚ â†‘ 10:35:42  Response (45ms)  90 00                              [9000] â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Expanded Entry View**:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Command Details                                                    [Ã—]  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Type:       SELECT                                                      â”‚\nâ”‚ Timestamp:  2024-01-15 10:35:42.123 UTC                                â”‚\nâ”‚ Session:    UICC_001 (abc123...)                                       â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Raw Hex:    00 A4 04 00 07 A0 00 00 00 04 10 10                        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Decoded:                                                                â”‚\nâ”‚   CLA: 00    INS: A4 (SELECT)    P1: 04    P2: 00                      â”‚\nâ”‚   Lc:  07    Data: A0 00 00 00 04 10 10 (AID)                          â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Response:   90 00 (Success)                                             â”‚\nâ”‚ Duration:   45ms                                                        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Key Behaviors**:\n- Virtual scrolling for 10,000+ entries\n- Auto-scroll to latest (unless user scrolled up)\n- Color-coded by direction (blue=received, green=sent)\n- Status word badges (green=9000, red=error, yellow=warning)\n- Click to expand with full details\n- Filter toolbar (session, command type, status word)\n- Copy hex to clipboard on click\n\n### Component 8: CommandBuilder\n\n**Purpose**: Form for building and sending manual GP commands.\n\n**Interface**:\n```javascript\nclass CommandBuilder {\n    constructor(container, stateManager, apiClient) {\n        this.container = container;\n        this.stateManager = stateManager;\n        this.apiClient = apiClient;\n        this.templates = this.loadTemplates();\n    }\n\n    render() {\n        // Render command builder form\n    }\n\n    selectTemplate(templateName) {\n        // Pre-fill form with template\n    }\n\n    buildCommand() {\n        // Construct APDU from form fields\n    }\n\n    async sendCommand() {\n        // Send command via API, show response\n    }\n\n    validateInput() {\n        // Validate hex input, parameters\n    }\n}\n```\n\n**Command Templates**:\n```javascript\nconst TEMPLATES = {\n    select: {\n        name: 'SELECT',\n        description: 'Select application by AID',\n        fields: [\n            { name: 'aid', label: 'Application AID', type: 'hex', placeholder: 'A0000000041010' }\n        ],\n        build: (fields) => `00A40400${toHexLength(fields.aid)}${fields.aid}`\n    },\n    getStatus: {\n        name: 'GET STATUS',\n        description: 'Get card content information',\n        fields: [\n            { name: 'scope', label: 'Scope', type: 'select', options: [\n                { value: '80', label: 'ISD' },\n                { value: '40', label: 'Applications' },\n                { value: '20', label: 'Load Files' }\n            ]}\n        ],\n        build: (fields) => `80F2${fields.scope}00024F00`\n    },\n    // ... more templates\n};\n```\n\n**Layout**:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Send Command                                              [Session: ...] â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Template: [SELECT â–¼]                                                     â”‚\nâ”‚                                                                          â”‚\nâ”‚ Application AID: [A0000000041010_________]  â„¹ï¸ 5-16 bytes hex           â”‚\nâ”‚                                                                          â”‚\nâ”‚ Raw Command: 00 A4 04 00 07 A0 00 00 00 04 10 10                        â”‚\nâ”‚                                                                          â”‚\nâ”‚                                         [Clear]  [Send Command â†’]        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Response:                                                                â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ 90 00                                                    [Success] â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Key Behaviors**:\n- Disabled when no active session selected\n- Template dropdown with common commands\n- Dynamic form fields based on selected template\n- Real-time hex preview as fields change\n- Raw hex input mode for advanced users\n- Input validation with helpful error messages\n- Response displayed inline with status interpretation\n- Keyboard shortcut: Ctrl+Enter to send\n\n### Component 9: AlertBanner\n\n**Purpose**: Displays error and warning alerts prominently.\n\n**Interface**:\n```javascript\nclass AlertBanner {\n    constructor(container, stateManager) {\n        this.container = container;\n        this.stateManager = stateManager;\n    }\n\n    render() {\n        // Render alert banner area\n    }\n\n    showAlert(alert) {\n        // Display new alert with animation\n    }\n\n    dismissAlert(alertId) {\n        // Mark alert as dismissed\n    }\n\n    formatAlert(alert) {\n        // Generate HTML for alert\n    }\n}\n```\n\n**Alert Types and Styling**:\n| Type | Color | Icon | Example Message |\n|------|-------|------|-----------------|\n| `error` | Red | â›” | Connection interrupted for session UICC_001 |\n| `warning` | Amber | âš ï¸ | NULL cipher in use - traffic unencrypted |\n| `psk_mismatch` | Red | ğŸ”‘ | PSK mismatch for identity UICC_002 from 192.168.1.100 |\n| `high_error_rate` | Amber | ğŸ“Š | High error rate detected: 45% failures |\n\n**Layout**:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ âš ï¸  NULL cipher negotiated - traffic is UNENCRYPTED          [Dismiss Ã—]â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Key Behaviors**:\n- Alerts stack below header\n- Newest alerts at top\n- Auto-dismiss info alerts after 10 seconds\n- Error alerts persist until dismissed\n- Dismiss button removes alert\n- Click alert to see details/context\n\n### Component 10: SettingsModal\n\n**Purpose**: Modal dialog for dashboard configuration.\n\n**Interface**:\n```javascript\nclass SettingsModal {\n    constructor(stateManager) {\n        this.stateManager = stateManager;\n    }\n\n    open() {\n        // Show modal\n    }\n\n    close() {\n        // Hide modal, save settings\n    }\n\n    render() {\n        // Render settings form\n    }\n\n    saveSettings() {\n        // Persist to localStorage\n    }\n}\n```\n\n**Settings Options**:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Settings                                                           [Ã—]  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Display                                                                  â”‚\nâ”‚   Theme:           [Light â–¼]  (Light / Dark)                            â”‚\nâ”‚   Hex Format:      [Uppercase â–¼]  (Uppercase / Lowercase / Grouped)     â”‚\nâ”‚   Timestamps:      [Relative â–¼]  (Relative / Local / UTC)               â”‚\nâ”‚                                                                          â”‚\nâ”‚ Behavior                                                                 â”‚\nâ”‚   Auto-scroll logs:    [âœ“]                                              â”‚\nâ”‚   Max log entries:     [1000____]                                       â”‚\nâ”‚                                                                          â”‚\nâ”‚ Export                                                                   â”‚\nâ”‚   Default format:      [JSON â–¼]  (JSON / CSV)                           â”‚\nâ”‚                                                                          â”‚\nâ”‚                                              [Reset Defaults]  [Save]   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Component 11: ToastManager\n\n**Purpose**: Shows transient feedback messages (success, info).\n\n**Interface**:\n```javascript\nclass ToastManager {\n    constructor() {\n        this.container = this.createContainer();\n    }\n\n    show(message, type = 'info', duration = 3000) {\n        // Display toast notification\n    }\n\n    success(message) {\n        this.show(message, 'success');\n    }\n\n    error(message) {\n        this.show(message, 'error', 5000);\n    }\n\n    info(message) {\n        this.show(message, 'info');\n    }\n}\n```\n\n**Toast Layout**:\n```\n                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                                    â”‚ âœ“ Command sent successfully â”‚\n                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Component 12: VirtualScroller\n\n**Purpose**: Efficiently renders large lists by only rendering visible items.\n\n**Interface**:\n```javascript\nclass VirtualScroller {\n    constructor(container, options) {\n        // options: { itemHeight, bufferSize, renderItem }\n    }\n\n    setItems(items) {\n        // Update data source\n    }\n\n    appendItems(items) {\n        // Add items to end\n    }\n\n    scrollToEnd() {\n        // Scroll to latest item\n    }\n\n    refresh() {\n        // Re-render visible items\n    }\n}\n```\n\n**Key Behaviors**:\n- Only renders visible items + buffer\n- Maintains scroll position on data update\n- Supports variable height items (with estimation)\n- Smooth scrolling animation\n\n## Data Models\n\n### Frontend Models\n\n```typescript\ninterface Session {\n    id: string;\n    pskIdentity: string;\n    cipherSuite: string;\n    state: 'handshaking' | 'connected' | 'active' | 'closed';\n    connectedAt: string;  // ISO timestamp\n    closedAt?: string;\n    commandCount: number;\n    lastActivity: string;\n    isNullCipher: boolean;\n}\n\ninterface APDULogEntry {\n    id: string;\n    sessionId: string;\n    direction: 'received' | 'sent';\n    timestamp: string;\n    rawHex: string;\n    decoded: DecodedAPDU;\n    statusWord?: string;\n    responseTimeMs?: number;\n}\n\ninterface DecodedAPDU {\n    cla: string;\n    ins: string;\n    insName: string;\n    p1: string;\n    p2: string;\n    lc?: string;\n    data?: string;\n    le?: string;\n}\n\ninterface Alert {\n    id: string;\n    type: 'error' | 'warning' | 'info' | 'psk_mismatch' | 'high_error_rate';\n    title: string;\n    message: string;\n    details?: Record<string, any>;\n    timestamp: string;\n    dismissed: boolean;\n}\n\ninterface Metrics {\n    uptime: number;  // seconds\n    totalSessions: number;\n    activeSessions: number;\n    totalCommands: number;\n    errorRate: number;\n}\n\ninterface Settings {\n    theme: 'light' | 'dark';\n    hexDisplay: 'uppercase' | 'lowercase' | 'grouped';\n    timestampFormat: 'relative' | 'local' | 'utc';\n    maxLogEntries: number;\n    autoScroll: boolean;\n    defaultExportFormat: 'json' | 'csv';\n}\n```\n\n## Design System\n\n### Design Tokens (CSS Custom Properties)\n\n```css\n:root {\n    /* Colors - Light Theme */\n    --color-primary: #2563EB;\n    --color-primary-hover: #1D4ED8;\n    --color-success: #16A34A;\n    --color-warning: #D97706;\n    --color-error: #DC2626;\n\n    --color-bg-primary: #FFFFFF;\n    --color-bg-secondary: #F9FAFB;\n    --color-bg-tertiary: #F3F4F6;\n\n    --color-text-primary: #111827;\n    --color-text-secondary: #6B7280;\n    --color-text-muted: #9CA3AF;\n\n    --color-border: #E5E7EB;\n    --color-border-focus: #2563EB;\n\n    /* Typography */\n    --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    --font-mono: 'SF Mono', Consolas, Monaco, 'Courier New', monospace;\n\n    --text-xs: 0.75rem;    /* 12px */\n    --text-sm: 0.875rem;   /* 14px */\n    --text-base: 1rem;     /* 16px */\n    --text-lg: 1.25rem;    /* 20px */\n    --text-xl: 1.5rem;     /* 24px */\n\n    --font-weight-normal: 400;\n    --font-weight-medium: 500;\n    --font-weight-semibold: 600;\n\n    /* Spacing */\n    --space-1: 0.25rem;    /* 4px */\n    --space-2: 0.5rem;     /* 8px */\n    --space-3: 0.75rem;    /* 12px */\n    --space-4: 1rem;       /* 16px */\n    --space-6: 1.5rem;     /* 24px */\n    --space-8: 2rem;       /* 32px */\n\n    /* Border Radius */\n    --radius-sm: 0.25rem;  /* 4px */\n    --radius-md: 0.5rem;   /* 8px */\n    --radius-lg: 0.75rem;  /* 12px */\n    --radius-full: 9999px;\n\n    /* Shadows */\n    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);\n    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);\n    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);\n\n    /* Transitions */\n    --transition-fast: 150ms ease;\n    --transition-normal: 200ms ease;\n}\n\n/* Dark Theme */\n[data-theme=\"dark\"] {\n    --color-bg-primary: #111827;\n    --color-bg-secondary: #1F2937;\n    --color-bg-tertiary: #374151;\n\n    --color-text-primary: #F9FAFB;\n    --color-text-secondary: #D1D5DB;\n    --color-text-muted: #9CA3AF;\n\n    --color-border: #374151;\n}\n```\n\n### Component CSS Classes (BEM)\n\n```css\n/* Session Card */\n.session-card { }\n.session-card--active { }\n.session-card--closed { }\n.session-card__header { }\n.session-card__identity { }\n.session-card__cipher { }\n.session-card__meta { }\n.session-card__badge { }\n.session-card__badge--warning { }\n\n/* APDU Log Entry */\n.log-entry { }\n.log-entry--received { }\n.log-entry--sent { }\n.log-entry__direction { }\n.log-entry__timestamp { }\n.log-entry__command { }\n.log-entry__hex { }\n.log-entry__status { }\n.log-entry__status--success { }\n.log-entry__status--error { }\n\n/* Alert Banner */\n.alert-banner { }\n.alert-banner--error { }\n.alert-banner--warning { }\n.alert-banner__icon { }\n.alert-banner__message { }\n.alert-banner__dismiss { }\n\n/* Button */\n.btn { }\n.btn--primary { }\n.btn--secondary { }\n.btn--danger { }\n.btn--disabled { }\n.btn--loading { }\n```\n\n## File Structure\n\n```\nsrc/cardlink/dashboard/\nâ”œâ”€â”€ __init__.py\nâ”œâ”€â”€ server.py                    # Dashboard HTTP server\nâ”œâ”€â”€ websocket.py                 # WebSocket handler\nâ”œâ”€â”€ routes/\nâ”‚   â”œâ”€â”€ __init__.py\nâ”‚   â”œâ”€â”€ api.py                   # REST API routes\nâ”‚   â””â”€â”€ export.py                # Export routes\nâ”œâ”€â”€ static/\nâ”‚   â”œâ”€â”€ index.html               # Main HTML page\nâ”‚   â”œâ”€â”€ css/\nâ”‚   â”‚   â”œâ”€â”€ tokens.css           # Design tokens\nâ”‚   â”‚   â”œâ”€â”€ base.css             # Base styles, reset\nâ”‚   â”‚   â”œâ”€â”€ components.css       # Component styles\nâ”‚   â”‚   â””â”€â”€ utilities.css        # Utility classes\nâ”‚   â”œâ”€â”€ js/\nâ”‚   â”‚   â”œâ”€â”€ app.js               # DashboardApp entry point\nâ”‚   â”‚   â”œâ”€â”€ state.js             # StateManager\nâ”‚   â”‚   â”œâ”€â”€ websocket.js         # WebSocketClient\nâ”‚   â”‚   â”œâ”€â”€ api.js               # APIClient\nâ”‚   â”‚   â”œâ”€â”€ components/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ header.js        # HeaderComponent\nâ”‚   â”‚   â”‚   â”œâ”€â”€ session-panel.js # SessionPanel\nâ”‚   â”‚   â”‚   â”œâ”€â”€ apdu-log.js      # APDULogComponent\nâ”‚   â”‚   â”‚   â”œâ”€â”€ command-builder.js # CommandBuilder\nâ”‚   â”‚   â”‚   â”œâ”€â”€ alert-banner.js  # AlertBanner\nâ”‚   â”‚   â”‚   â”œâ”€â”€ settings-modal.js # SettingsModal\nâ”‚   â”‚   â”‚   â””â”€â”€ toast.js         # ToastManager\nâ”‚   â”‚   â”œâ”€â”€ utils/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ hex.js           # Hex formatting utilities\nâ”‚   â”‚   â”‚   â”œâ”€â”€ time.js          # Time formatting utilities\nâ”‚   â”‚   â”‚   â”œâ”€â”€ apdu.js          # APDU decoding utilities\nâ”‚   â”‚   â”‚   â””â”€â”€ virtual-scroll.js # VirtualScroller\nâ”‚   â”‚   â””â”€â”€ templates.js         # Command templates\nâ”‚   â””â”€â”€ assets/\nâ”‚       â””â”€â”€ icons/               # SVG icons\nâ””â”€â”€ templates/                   # Jinja2 templates (if needed)\n```\n\n## Backend API Design\n\n### REST Endpoints\n\n```python\n# routes/api.py\n\n@router.get('/api/sessions')\nasync def get_sessions():\n    \"\"\"List all sessions (active first, then recent).\"\"\"\n    return {\n        'sessions': [\n            {\n                'id': 'uuid',\n                'pskIdentity': 'UICC_001',\n                'cipherSuite': 'TLS_PSK_WITH_AES_128_CBC_SHA256',\n                'state': 'active',\n                'connectedAt': '2024-01-15T10:30:00Z',\n                'commandCount': 42,\n                'lastActivity': '2024-01-15T10:35:00Z',\n                'isNullCipher': False\n            }\n        ]\n    }\n\n@router.get('/api/sessions/{session_id}/logs')\nasync def get_session_logs(session_id: str, limit: int = 100, offset: int = 0):\n    \"\"\"Get APDU logs for a session.\"\"\"\n    return {\n        'logs': [...],\n        'total': 500,\n        'hasMore': True\n    }\n\n@router.get('/api/metrics')\nasync def get_metrics():\n    \"\"\"Get server metrics.\"\"\"\n    return {\n        'uptime': 3600,\n        'totalSessions': 150,\n        'activeSessions': 2,\n        'totalCommands': 5420,\n        'errorRate': 0.02\n    }\n\n@router.post('/api/sessions/{session_id}/commands')\nasync def send_command(session_id: str, body: CommandRequest):\n    \"\"\"Send manual APDU command.\"\"\"\n    # body: { commandHex: '00A4040007A0000000041010' }\n    return {\n        'responseHex': '9000',\n        'responseTimeMs': 45\n    }\n\n@router.get('/api/export')\nasync def export_logs(format: str, session_id: str = None, start: str = None, end: str = None):\n    \"\"\"Export logs as JSON or CSV.\"\"\"\n    # Returns file download\n```\n\n### WebSocket Protocol\n\n```python\n# websocket.py\n\nclass DashboardWebSocket:\n    \"\"\"WebSocket handler for real-time updates.\"\"\"\n\n    async def handle_connection(self, websocket):\n        # Subscribe to EventEmitter\n        # Forward events to client\n\n    def format_event(self, event_type: str, data: dict) -> str:\n        \"\"\"Format event as JSON message.\"\"\"\n        return json.dumps({\n            'type': event_type,\n            'data': data,\n            'timestamp': datetime.utcnow().isoformat()\n        })\n```\n\n**WebSocket Message Format**:\n```json\n{\n    \"type\": \"apdu_received\",\n    \"data\": {\n        \"sessionId\": \"uuid\",\n        \"rawHex\": \"00A4040007A0000000041010\",\n        \"decoded\": { \"cla\": \"00\", \"ins\": \"A4\", ... }\n    },\n    \"timestamp\": \"2024-01-15T10:35:42.123Z\"\n}\n```\n\n## Testing Strategy\n\n### Unit Tests\n\n| Component | Test Focus |\n|-----------|------------|\n| StateManager | State updates, subscriptions, persistence |\n| APIClient | Request formatting, response parsing, error handling |\n| VirtualScroller | Scroll position, item rendering, performance |\n| Hex utilities | Formatting, parsing, validation |\n| APDU decoder | Command parsing, INS name lookup |\n\n### Integration Tests\n\n| Test | Description |\n|------|-------------|\n| WebSocket connection | Connect, receive events, auto-reconnect |\n| Session flow | Session appears on connect, updates on activity, removes on close |\n| Command sending | Build command, send, receive response |\n| Export functionality | Export JSON/CSV, verify format |\n\n### E2E Tests\n\n| Test | Description |\n|------|-------------|\n| Full dashboard load | Page loads, connects, shows sessions |\n| Real-time updates | APDU appears within 500ms of occurrence |\n| Manual command | Send SELECT, see response |\n| Settings persistence | Change theme, refresh, theme persists |\n\n## Performance Considerations\n\n1. **Virtual Scrolling**: APDU log uses virtual scrolling to handle 10,000+ entries without DOM bloat.\n\n2. **Debounced Updates**: Rapid WebSocket events batched for rendering (16ms frame budget).\n\n3. **Lazy Loading**: Session logs loaded on-demand when session selected.\n\n4. **CSS Containment**: Use `contain: content` on list items for rendering optimization.\n\n5. **Web Workers**: Consider Web Worker for APDU decoding if CPU-intensive.\n\n## Accessibility Considerations\n\n1. **Keyboard Navigation**: Tab through interactive elements, Enter to activate, Escape to close modals.\n\n2. **ARIA Labels**: All buttons, inputs, and dynamic content have appropriate ARIA labels.\n\n3. **Focus Management**: Modal traps focus, returns focus on close.\n\n4. **Color Contrast**: All text meets WCAG 2.1 AA (4.5:1 ratio).\n\n5. **Screen Reader**: Status changes announced via aria-live regions.\n",
  "fileStats": {
    "size": 39517,
    "lines": 1084,
    "lastModified": "2025-11-25T10:51:06.611Z"
  },
  "comments": []
}