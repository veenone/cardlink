{
  "id": "snapshot_1764062811219_svvuh5zjx",
  "approvalId": "approval_1764062811209_a4u1it3dp",
  "approvalTitle": "Tech Steering Document",
  "version": 1,
  "timestamp": "2025-11-25T09:26:51.219Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Technology Stack\n\n## Project Type\nCLI tool with integrated web dashboard for GlobalPlatform SCP81 UICC OTA testing. The platform provides server simulation, mobile phone control, smart card provisioning, and automated test execution capabilities.\n\n## Core Technologies\n\n### Primary Language(s)\n- **Language**: Python 3.9+\n- **Runtime**: CPython\n- **Language-specific tools**: pip, venv, setuptools\n\n### Key Dependencies/Libraries\n\n| Library | Purpose | Version |\n|---------|---------|---------|\n| **sslpsk3** | PSK-TLS support for secure UICC communication | Latest |\n| **pyscard** | PC/SC smart card interface for UICC provisioning | Latest |\n| **click** | CLI framework for command-line interface | Latest |\n| **pytest** | Testing framework for unit/integration/E2E tests | Latest |\n| **pyyaml** | YAML configuration parsing | Latest |\n| **aiohttp** or **Flask** | Web server for dashboard backend | Latest |\n| **websockets** | Real-time communication for dashboard | Latest |\n\n### Application Architecture\nThe application follows a modular, layered architecture:\n\n```\n┌─────────────────────────────────────────────────────┐\n│                    CLI Layer                         │\n│  (gp-server, gp-phone, gp-provision, gp-test)       │\n├─────────────────────────────────────────────────────┤\n│                  Service Layer                       │\n│  ┌───────────┐ ┌───────────┐ ┌───────────┐         │\n│  │ AdminServer│ │PhoneControl│ │UICCProvision│       │\n│  │ + Dashboard│ │           │ │           │         │\n│  └───────────┘ └───────────┘ └───────────┘         │\n├─────────────────────────────────────────────────────┤\n│                 Protocol Layer                       │\n│  (APDU, TLV, GP Commands, SMS PDU, BIP Commands)    │\n└─────────────────────────────────────────────────────┘\n```\n\n- **CLI Layer**: User-facing commands using Click framework\n- **Service Layer**: Core business logic for server, phone, and provisioning\n- **Protocol Layer**: Low-level protocol implementations (APDU, TLV, GP commands)\n\n### Data Storage\n- **Primary storage**: File-based (YAML configurations, JSON logs)\n- **Caching**: In-memory session state\n- **Data formats**:\n  - YAML for test configurations and card profiles\n  - JSON for communication logs and reports\n  - Binary for APDU/TLV data\n\n### External Integrations\n- **APIs**:\n  - ADB (Android Debug Bridge) for phone control\n  - PC/SC for smart card reader access\n- **Protocols**:\n  - PSK-TLS 1.2 for UICC communication\n  - HTTP/HTTPS for Admin Server protocol\n  - AT commands for modem interface\n  - SMS-PP PDU for trigger messages\n- **Authentication**: PSK (Pre-Shared Key) for TLS sessions\n\n### Monitoring & Dashboard Technologies\n- **Dashboard Framework**: Lightweight web framework (Flask/aiohttp) with vanilla JS or minimal frontend\n- **Real-time Communication**: WebSocket for live APDU streaming and event updates\n- **Visualization**: Simple HTML/CSS tables for log display, hex viewers for APDU data\n- **State Management**: Server-side session state, WebSocket push for updates\n\n## Development Environment\n\n### Build & Development Tools\n- **Build System**: setuptools with pyproject.toml\n- **Package Management**: pip with virtual environments (venv)\n- **Development workflow**:\n  - Editable install (`pip install -e \".[dev,pcsc]\"`)\n  - Hot reload for dashboard development\n  - pytest watch mode for TDD\n\n### Code Quality Tools\n- **Static Analysis**: mypy for type checking, pylint/flake8 for linting\n- **Formatting**: black for code formatting, isort for import sorting\n- **Testing Framework**:\n  - pytest for all test types\n  - pytest-cov for coverage\n  - pytest-asyncio for async tests\n- **Documentation**: Sphinx or mkdocs for API documentation\n\n### Version Control & Collaboration\n- **VCS**: Git\n- **Branching Strategy**: GitHub Flow (feature branches, main branch)\n- **Code Review Process**: Pull requests with required reviews\n\n### Dashboard Development\n- **Live Reload**: Browser auto-refresh or WebSocket-based updates\n- **Port Management**: Configurable port (default 8080 for dashboard, 8443 for PSK-TLS server)\n- **Multi-Instance Support**: Single dashboard instance per server\n\n## Deployment & Distribution\n- **Target Platform(s)**: Linux, macOS, Windows (desktop/laptop with USB)\n- **Distribution Method**: PyPI package installation via pip\n- **Installation Requirements**:\n  - Python 3.9+\n  - ADB (Android SDK Platform Tools)\n  - PC/SC Lite (pcscd on Linux)\n  - OpenSSL 1.1.1+\n  - USB connection to Android phone\n  - PC/SC smart card reader (for provisioning)\n- **Update Mechanism**: pip upgrade\n\n## Technical Requirements & Constraints\n\n### Performance Requirements\n- **Test cycle time**: Sub-5-second end-to-end test execution\n- **Server response**: Handle mobile network latency (60s socket timeout, 300s session timeout)\n- **Dashboard updates**: Real-time (<100ms latency for WebSocket updates)\n- **Memory**: Reasonable memory footprint for long-running server sessions\n\n### Compatibility Requirements\n- **Platform Support**:\n  - Linux (Ubuntu 20.04+, Debian 11+)\n  - macOS (10.15+)\n  - Windows 10/11\n- **Android Support**: Android 8.0+ with USB debugging enabled\n- **Dependency Versions**:\n  - Python 3.9 minimum\n  - OpenSSL 1.1.1+ for PSK-TLS support\n- **Standards Compliance**:\n  - GlobalPlatform Card Spec v2.2 Amendment B (SCP81)\n  - 3GPP TS 23.040 (SMS PDU)\n  - 3GPP TS 102 223 (BIP/CAT)\n  - 3GPP TS 102 225 (OTA Command Packets)\n\n### Security & Compliance\n- **Security Requirements**:\n  - PSK-TLS for all UICC communication\n  - Secure key handling (no plaintext key storage in logs)\n  - ADM key protection for card provisioning\n- **Compliance Standards**: GlobalPlatform certification compatibility\n- **Threat Model**: Local testing environment (trusted network assumption)\n\n### Scalability & Reliability\n- **Expected Load**: Single device testing (v1.0), multi-device future\n- **Availability Requirements**: Development/testing tool, no uptime requirements\n- **Growth Projections**: Multi-phone parallel testing in future versions\n\n## Technical Decisions & Rationale\n\n### Decision Log\n\n1. **Python 3.9+**: Chosen for rapid development, excellent library ecosystem (pyscard, sslpsk3), and cross-platform support. Trade-off: slower than native code, acceptable for test tool.\n\n2. **PSK-TLS via sslpsk3**: Required for SCP81 compliance. Standard TLS libraries don't support PSK cipher suites natively.\n\n3. **ADB for Phone Control**: Universal Android debugging interface, no root required for basic operations. Trade-off: Some AT command features may need root.\n\n4. **PC/SC for Card Provisioning**: Industry-standard smart card interface. Allows same card reader to work across platforms.\n\n5. **File-based Configuration**: YAML for human-readable test configurations. JSON for machine-generated logs. No database needed for test tool.\n\n6. **WebSocket for Dashboard**: Real-time bidirectional communication for live APDU streaming without polling overhead.\n\n7. **Click for CLI**: Mature, well-documented CLI framework with good support for complex command hierarchies.\n\n## Known Limitations\n\n- **AT Command Access**: Some phones restrict modem access without root. Document tested phone models.\n- **BIP Support Varies**: Not all Android versions/phones handle BIP consistently. Fallback mechanisms needed.\n- **No iOS Support (v1.0)**: iOS restrictions prevent ADB-style control. Future enhancement.\n- **Single Device Focus (v1.0)**: Parallel testing deferred to future version.\n- **PSK-TLS Library**: sslpsk3 may have platform-specific issues. Test thoroughly on all target platforms.\n",
  "fileStats": {
    "size": 8231,
    "lines": 175,
    "lastModified": "2025-11-25T09:26:38.603Z"
  },
  "comments": []
}