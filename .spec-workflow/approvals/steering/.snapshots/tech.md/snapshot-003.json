{
  "id": "snapshot_1764063396818_1oktjww46",
  "approvalId": "approval_1764063310682_fyy1t0ki9",
  "approvalTitle": "Tech Steering Document (Revised)",
  "version": 3,
  "timestamp": "2025-11-25T09:36:36.818Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Technology Stack\n\n## Project Type\nCLI tool with integrated web dashboard for GlobalPlatform SCP81 UICC OTA testing. The platform provides server simulation, device control (mobile phones and IoT modems), smart card provisioning, network simulator integration, and automated test execution capabilities.\n\n## Core Technologies\n\n### Primary Language(s)\n- **Language**: Python 3.9+\n- **Runtime**: CPython\n- **Language-specific tools**: pip, venv, setuptools\n\n### Key Dependencies/Libraries\n\n| Library | Purpose | Version |\n|---------|---------|---------|\n| **sslpsk3** | PSK-TLS support for secure UICC communication | Latest |\n| **pyscard** | PC/SC smart card interface for UICC provisioning | Latest |\n| **click** | CLI framework for command-line interface | Latest |\n| **pytest** | Testing framework for unit/integration/E2E tests | Latest |\n| **pyyaml** | YAML configuration parsing | Latest |\n| **aiohttp** or **Flask** | Web server for dashboard backend | Latest |\n| **websockets** | Real-time communication for dashboard | Latest |\n\n### Application Architecture\nThe application follows a modular, layered architecture:\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│                         CLI Layer                                │\n│  (gp-server, gp-phone, gp-modem, gp-provision, gp-test)         │\n├─────────────────────────────────────────────────────────────────┤\n│                       Frontend Layer                             │\n│  ┌─────────────────────────────────────────────────────────┐    │\n│  │                  Web Dashboard                           │    │\n│  │  - OTA Activity Management (sessions, scripts, triggers) │    │\n│  │  - TLS Handshake Monitor (PSK negotiation, cipher info)  │    │\n│  │  - Real-time APDU Communication Log                      │    │\n│  │  - Manual RAM Command Interface                          │    │\n│  └─────────────────────────────────────────────────────────┘    │\n├─────────────────────────────────────────────────────────────────┤\n│                       Service Layer                              │\n│  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐       │\n│  │AdminServer│ │DeviceCtrl │ │UICCProvisi│ │NetworkSim │       │\n│  │(PSK-TLS)  │ │(Phone/IoT)│ │           │ │Integration│       │\n│  └───────────┘ └───────────┘ └───────────┘ └───────────┘       │\n├─────────────────────────────────────────────────────────────────┤\n│                      Protocol Layer                              │\n│  (APDU, TLV, GP Commands, SMS PDU, BIP Commands, AT Commands)   │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n- **CLI Layer**: User-facing commands using Click framework\n- **Frontend Layer**: Web-based dashboard for OTA activity management, TLS handshake monitoring, and manual RAM command execution\n- **Service Layer**: Core business logic for server, device control (phones + IoT modems), provisioning, and network simulator integration\n- **Protocol Layer**: Low-level protocol implementations (APDU, TLV, GP commands, AT commands)\n\n### Data Storage\n- **Primary storage**: File-based (YAML configurations, JSON logs)\n- **Caching**: In-memory session state\n- **Data formats**:\n  - YAML for test configurations and card profiles\n  - JSON for communication logs and reports\n  - Binary for APDU/TLV data\n\n### External Integrations\n- **APIs**:\n  - ADB (Android Debug Bridge) for Android phone control\n  - PC/SC for smart card reader access\n  - QXDM integration for Qualcomm-based IoT modem diagnostics\n- **Protocols**:\n  - PSK-TLS 1.2 for UICC communication\n  - HTTP/HTTPS for Admin Server protocol\n  - AT commands for modem interface (phones and IoT modules)\n  - SMS-PP PDU for trigger messages\n  - WebSocket for network simulator integration\n  - TCP/IP for network simulator connectivity\n- **Network Simulator Integration**:\n  - Amarisoft LTE/5G network simulator support\n  - WebSocket-based real-time communication\n  - TCP/IP fallback connectivity\n  - Simulated network event triggers\n- **Authentication**: PSK (Pre-Shared Key) for TLS sessions\n\n### Target Device Support\n- **Mobile Phones**:\n  - Android 8.0+ smartphones via ADB\n  - USB debugging interface\n  - Tested models: Google Pixel, Samsung Galaxy, OnePlus\n- **IoT Modems**:\n  - Quectel RG500Q-EU (5G)\n  - Quectel EG25-G (LTE Cat 4)\n  - Other AT command compatible modems\n  - USB/Serial interface\n  - QXDM diagnostic tool integration for Qualcomm chipsets\n\n### Monitoring & Dashboard Technologies\n- **Dashboard Framework**: Lightweight web framework (Flask/aiohttp) with vanilla JS or minimal frontend\n- **Real-time Communication**: WebSocket for live APDU streaming, TLS events, and network simulator updates\n- **Visualization**:\n  - TLS handshake monitor (PSK identity, cipher suite, session info)\n  - APDU communication log with hex/decoded views\n  - OTA session management interface\n  - Network simulator status panel\n- **State Management**: Server-side session state, WebSocket push for updates\n- **Interactive Features**:\n  - Manual RAM command builder and executor\n  - Script queue management\n  - Trigger controls (SMS-PP, event-based)\n  - TLS session inspection\n\n## Development Environment\n\n### Build & Development Tools\n- **Build System**: setuptools with pyproject.toml\n- **Package Management**: pip with virtual environments (venv)\n- **Development workflow**:\n  - Editable install (`pip install -e \".[dev,pcsc]\"`)\n  - Hot reload for dashboard development\n  - pytest watch mode for TDD\n\n### Code Quality Tools\n- **Static Analysis**: mypy for type checking, pylint/flake8 for linting\n- **Formatting**: black for code formatting, isort for import sorting\n- **Testing Framework**:\n  - pytest for all test types\n  - pytest-cov for coverage\n  - pytest-asyncio for async tests\n- **Documentation**: Sphinx or mkdocs for API documentation\n\n### Version Control & Collaboration\n- **VCS**: Git\n- **Branching Strategy**: GitHub Flow (feature branches, main branch)\n- **Code Review Process**: Pull requests with required reviews\n\n### Dashboard Development\n- **Live Reload**: Browser auto-refresh or WebSocket-based updates\n- **Port Management**: Configurable port (default 8080 for dashboard, 8443 for PSK-TLS server)\n- **Multi-Instance Support**: Single dashboard instance per server\n\n## Deployment & Distribution\n- **Target Platform(s)**: Linux, macOS, Windows (desktop/laptop with USB)\n- **Distribution Method**: PyPI package installation via pip\n- **Installation Requirements**:\n  - Python 3.9+\n  - ADB (Android SDK Platform Tools) - for phone control\n  - PC/SC Lite (pcscd on Linux) - for card provisioning\n  - OpenSSL 1.1.1+\n  - USB connection to target device (phone or IoT modem)\n  - PC/SC smart card reader (for provisioning)\n  - Serial/USB drivers for IoT modems (if applicable)\n  - QXDM license (optional, for Qualcomm modem diagnostics)\n- **Update Mechanism**: pip upgrade\n\n## Technical Requirements & Constraints\n\n### Performance Requirements\n- **Test cycle time**: Sub-5-second end-to-end test execution\n- **Server response**: Handle mobile network latency (60s socket timeout, 300s session timeout)\n- **Dashboard updates**: Real-time (<100ms latency for WebSocket updates)\n- **Memory**: Reasonable memory footprint for long-running server sessions\n\n### Compatibility Requirements\n- **Platform Support**:\n  - Linux (Ubuntu 20.04+, Debian 11+)\n  - macOS (10.15+)\n  - Windows 10/11\n- **Target Device Support**:\n  - Android 8.0+ smartphones with USB debugging enabled\n  - Quectel RG500Q-EU, EG25-G and compatible IoT modems\n  - Any AT command compatible cellular modem\n- **Network Simulator Support**:\n  - Amarisoft Callbox (LTE/5G)\n  - WebSocket API compatibility\n- **Dependency Versions**:\n  - Python 3.9 minimum\n  - OpenSSL 1.1.1+ for PSK-TLS support\n- **Standards Compliance**:\n  - GlobalPlatform Card Spec v2.2 Amendment B (SCP81)\n  - 3GPP TS 23.040 (SMS PDU)\n  - 3GPP TS 102 223 (BIP/CAT)\n  - 3GPP TS 102 225 (OTA Command Packets)\n  - 3GPP TS 27.007 (AT Command Set for modems)\n\n### Security & Compliance\n- **Security Requirements**:\n  - PSK-TLS for all UICC communication\n  - Secure key handling (no plaintext key storage in logs)\n  - ADM key protection for card provisioning\n- **Compliance Standards**: GlobalPlatform certification compatibility\n- **Threat Model**: Local testing environment (trusted network assumption)\n\n### Scalability & Reliability\n- **Expected Load**: Single device testing (v1.0), multi-device future\n- **Availability Requirements**: Development/testing tool, no uptime requirements\n- **Growth Projections**: Multi-phone parallel testing in future versions\n\n## Technical Decisions & Rationale\n\n### Decision Log\n\n1. **Python 3.9+**: Chosen for rapid development, excellent library ecosystem (pyscard, sslpsk3), and cross-platform support. Trade-off: slower than native code, acceptable for test tool.\n\n2. **PSK-TLS via sslpsk3**: Required for SCP81 compliance. Standard TLS libraries don't support PSK cipher suites natively.\n\n3. **ADB for Phone Control**: Universal Android debugging interface, no root required for basic operations. Trade-off: Some AT command features may need root.\n\n4. **AT Commands for IoT Modems**: Direct serial/USB communication with modems like Quectel. More reliable than ADB for dedicated cellular modules.\n\n5. **PC/SC for Card Provisioning**: Industry-standard smart card interface. Allows same card reader to work across platforms.\n\n6. **File-based Configuration**: YAML for human-readable test configurations. JSON for machine-generated logs. No database needed for test tool.\n\n7. **WebSocket for Dashboard & Network Simulator**: Real-time bidirectional communication for live APDU streaming, TLS monitoring, and network simulator integration without polling overhead.\n\n8. **Click for CLI**: Mature, well-documented CLI framework with good support for complex command hierarchies.\n\n9. **Amarisoft Integration**: Industry-standard network simulator with well-documented WebSocket/TCP API. Enables controlled network environment testing.\n\n10. **QXDM Integration**: Essential for debugging Qualcomm-based IoT modems. Provides low-level diagnostic access for troubleshooting BIP/CAT issues.\n\n## Known Limitations\n\n- **AT Command Access**: Some phones restrict modem access without root. Document tested phone models.\n- **BIP Support Varies**: Not all Android versions/phones handle BIP consistently. Fallback mechanisms needed.\n- **No iOS Support (v1.0)**: iOS restrictions prevent ADB-style control. Future enhancement.\n- **Single Device Focus (v1.0)**: Parallel testing deferred to future version.\n- **PSK-TLS Library**: sslpsk3 may have platform-specific issues. Test thoroughly on all target platforms.\n- **IoT Modem Variations**: Different modem firmware versions may have varying AT command support. Document tested firmware versions.\n- **QXDM License Required**: QXDM diagnostic tool requires Qualcomm license. Optional but recommended for Qualcomm-based modems.\n- **Network Simulator Cost**: Amarisoft requires commercial license. Integration designed to be optional.\n",
  "fileStats": {
    "size": 12257,
    "lines": 232,
    "lastModified": "2025-11-25T09:35:03.482Z"
  },
  "comments": []
}